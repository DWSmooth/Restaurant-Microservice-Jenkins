pipeline {
    agent any
    stages {
        stage("install common library") {
            steps {
                // clone the common library git repo
                bat 'git clone https://github.com/april2022-j-capstone/common-library.git'
                // cd to the common library repo root
                dir("common-library") {
                    // switch to common library dev branch
                    bat 'git checkout dev'
                    // maven clean install
                    bat 'mvn -X clean install'
                    // sh 'ls -aough'
                }
                // dir("restaurant-microservice") {
                //     // maven clean package to produce jar
                //     sh 'mvn -X clean package'
                //     // publish package
                //     // archive package?
                // }
            }
        }
        stage("build microservice") {
            steps {
                // cd to the main repo package
                dir("restaurant-microservice") {
                    // maven clean package to produce jar
                    bat 'mvn -X clean package'
                    // publish package
                    // archive package?
                }
            }
        }
    }
    post {
        always {
            bat 'powershell -c "Remove-Item \'Common-Library/\' -Recurse'
        }
    }
}